{
  "kind": "build_request",
  "title": "Fix client signup failure: \"blob too long for principal\"",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix backend client signup and auto-repair logic so it never traps with \"blob too long for principal\" when generating linkedPrincipal for email/mobile identifiers, including: clientSignup, autoRepairClientAccount, and repairMissingLinkedPrincipals.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Ab yah kya problem hai"
        ]
      },
      "acceptanceCriteria": [
        "Signing up with a typical email address (e.g., name@gmail.com) succeeds without any backend trap/reject errors.",
        "Signing up with a 10-digit mobile number succeeds without any backend trap/reject errors.",
        "clientPasswordLogin and verifyOtp auto-repair paths do not trap when linking accounts missing linkedPrincipal.",
        "Admin bulk repair (repairMissingLinkedPrincipals) completes without trapping, even when identifiers are long (emails).",
        "No backend state migration is required (no schema/type changes)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the client signup UI to use the validated/normalized identifier value from validateClientIdentifier (e.g., digit-only mobile normalization) when deciding whether to send email vs mobile and when submitting the signup mutation payload.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Ab yah kya problem hai"
        ]
      },
      "acceptanceCriteria": [
        "If a user enters a mobile number with spaces/dashes, the signup request uses the normalized 10-digit number.",
        "If a user enters an email with leading/trailing whitespace, the signup request uses the trimmed/normalized email.",
        "The signup form no longer produces backend errors caused by sending an unnormalized identifier type (email vs mobile)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Improve client-facing error messaging for unexpected backend traps during signup: map the specific error text \"blob too long for principal\" to a user-friendly English message and avoid showing raw trap text in the UI.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-5"
        ],
        "quotes": [
          "Ab yah kya problem hai"
        ]
      },
      "acceptanceCriteria": [
        "If the backend ever returns an error containing \"blob too long for principal\", the UI displays a clear English message (e.g., \"Signup failed due to a server error. Please try again.\") instead of the raw text.",
        "Other existing error mappings remain unchanged."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor (all logic in backend/main.mo).",
    "Do not edit files under frontend/src/components/ui or any other immutablePaths listed in SYSTEM_CONTEXT.",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Adding new authentication providers (only existing password/OTP flows).",
    "Introducing external databases or additional backend services.",
    "UI redesign beyond what is necessary to fix signup and error messaging."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}